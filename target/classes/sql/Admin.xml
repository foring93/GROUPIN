<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="Admin">

<select id="AdminSearchUser" parameterType="String" resultType="member">
select * from gusers where userid like '%' ||  #{keyword} || '%'
</select>


<select id="admindeleteUser" parameterType="String" resultType="int"> 
update gusers set USERSTATUS = 2, USERSTATUSCODE = sysdate where userid = #{id}
</select>

	<select id="getadminusercategory" parameterType="String" resultType="String">
	SELECT SCATEGORYNAME FROM GUSERCATEGORY,GCATEGORY2 WHERE USERKEY = #{key} 
	AND gcategory2.scategorykey = gusercategory.categorykey
	</select>
		
	<select id="getAllUserList" parameterType="Map" resultType="member">
	  <![CDATA[ 
	  SELECT * FROM (
				SELECT b.*, rownum rnum
				FROM (SELECT USERKEY, USERID, USERPASSWORD, USERIMAGEFILE, 
				USERIMAGEORIGIN, USERAGE, 
				(SELECT SWHERE ||' ' ||  DWHERE LocationName
				 FROM GLOCATION WHERE LOCATIONKEY = USERLOCATION) LocationName,
				  GENDER, USEREMAIL, USERJOINDATE,useroptionadmin,
				   useroptiongroup, userstatus, 
                userstatuscode, logintype FROM GUSERS WHERE userstatus = #{type}
				ORDER BY userjoindate ) b )
				WHERE RNUM >= #{startrow} and rnum <= #{endrow}
				]]>
	</select>
	
	<select id="getListCount" parameterType="int" resultType="int">
	select count(*) from gusers where userStatus = #{type}
	</select>
	

	<select id="getStatisticsAge" resultType="statisticsAge">
	select agevalue age, count(*) value from gusers, gage where agekey = userage group by agevalue
	</select>
	
	<select id="getStatisticsLocation" resultType="statisticsLocation">
	select swhere location, count(userlocation) value from glocation,gusers where 
	locationkey = userlocation group by swhere
	</select>
	
	
	<select id="getStatisticsJoinDate" resultType="statisticsJoinDate">
	  <![CDATA[ 
	  select rownum, joindate, value from (SELECT to_char(userjoindate,'mm-dd') joindate,
	count(*) value FROM GUSERS group by to_char(userjoindate,'mm-dd') 
	order by to_char(userjoindate,'mm-dd') DESC) 
	where rownum <= 7   
	]]>
	</select>
	
	<select id="getStatisticsCategory" resultType="statisticsCategory">
	 <![CDATA[ 
	select category, value from (select scategoryname category, count(scategoryname) 
	value from gcategory2,ggroup where CATEGORYKEY = SCATEGORYKEY 
	group by scategoryname order by count(scategoryname) desc) 
	where rownum <10
	]]>
	</select>

	
	
	


</mapper>
