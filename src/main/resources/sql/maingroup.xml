<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="maingroup">

	<!-- 메인 베스트 모임 인원순 많은 순, 로그인 안했을경우 모임 목록도 이걸로 하기 -->
	<select id="bestMainGroup" resultType="group">
		   <![CDATA[ 
		select * from ggroup where groupkey in (
				select groupkey from (select groupkey, count(*)
				from ggroupmember 
				group by groupkey 
				order by count(*) desc)
		where rownum <= 3)
			]]>
	</select>


	<!-- 메인 모임 목록- 로그인했을 경우 관심 카테고리의 인원 많은 순 -->

	<select id="BestUserCateogryGroup" resultType="group" parameterType="int">
  <![CDATA[ 
		select * from ggroup

		where groupkey in (
		select groupkey from (select groupkey, count(*)
		from ggroupmember
		group by groupkey
		order by count(*) desc)
		where rownum <= 3)

		and categoryKey in (select categoryKey from gusercategory where userkey =
		#{userkey})
			]]>
	</select>

	
	
	<!-- 추천모임 : 로그인 상태일 경우 : 관심카테고리 중 post 등록개수가 일주일간 제일 많은 순 -->
	<select id="recoGroupsUsers" resultType="group" parameterType="int">
	  <![CDATA[ 
	select * from 
 
				(select * from ggroup
					      where categoryKey
						  in (select categoryKey from gusercategory where userkey = #{userkey})) ggroup,

				(select groupkey, count(*) postcount from post
						  where postdate between sysdate-7 and sysdate-1
						  group by groupkey order by postcount desc) post
						  
where ggroup.groupkey = post.groupkey and rownum < 5;
]]>
	</select>



<!-- <추천모임 로그인 상태가 아닐 경우 : 모든 모임 중 post 등록개수가 일주일간 제일 많은 수 -->
<select id="recoGroupsNotUsers">
  <![CDATA[ 
	select * from 
 
				 ggroup,

				(select groupkey, count(*) postcount from post
						  where postdate between sysdate-7 and sysdate-1
						  group by groupkey order by postcount desc) post
						  
				where ggroup.groupkey = post.groupkey and rownum < 5;
]]>
</select>
</mapper>