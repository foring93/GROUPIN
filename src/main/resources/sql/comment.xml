<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace = "comment">
	<!-- 글에 댓글달기 (대댓 X) -->
	<insert id = "postReply" parameterType = "map">
		INSERT INTO GCOMMENT
		VALUES (GCOMMENTSEQ.NEXTVAL, #{postkey}, #{userkey}, #{content}, 
				GCOMMENTSEQ.CURRVAL, #{commentReLev}, #{commentReSeq}, SYSDATE, #{groupkey}, #{commentshow})
	</insert>
	
	<!-- 댓글달린 댓글의 값들 가져온다. -->
	<select id = "getCommentInfo" parameterType = "int" resultType = "comment">
		SELECT COMMEMTREREF, COMMENTRESEQ
		FROM GCOMMENT
		WHERE COMMNETNUM = #{COMMENTNUM}
	</select>
	
	<!-- 대댓을 위한 첫 번째 과정 -->
	<update id = "updateComment" parameterType = "comment">
		UPDATE GCOMMENT
		SET COMMENTRESEQ = COMMENTRESEQ + 1
		WHERE COMMEMTREREF = #{commemtReRef} AND COMMENTRESEQ &gt; #{commentReSeq}
	</update>
	
	<!-- 대댓 달기 -->
	<insert id = "commentReply" parameterType = "map">
		INSERT INTO GCOMMENT
		VALUES(GCOMMENTSEQ.NEXTVAL, #{postkey}, #{userkey}, #{content},
			   #{commentnum}, #{commentReLev}, #{commentReSeq}, SYSDATE, #{groupkey}, #{commentshow})
	</insert>
</mapper>